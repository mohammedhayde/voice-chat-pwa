# ๐๏ธ ูุดุฑูุน Voice Chat PWA - ููุฎุต ุดุงูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชุทุจูู Progressive Web App (PWA) ููุฏุฑุฏุดุฉ ุงูุตูุชูุฉ ุงูุฌูุงุนูุฉ ุจุงุณุชุฎุฏุงู:
- **Frontend:** Next.js 16 + React 19 + TypeScript
- **Voice/Video:** Agora RTC SDK
- **Text Chat:** Pusher (Real-time)
- **Backend API:** Chat Room API (External)
- **Authentication:** JWT (Access + Refresh Tokens)

---

## โ ุงูููุฒุงุช ุงูููุชููุฉ

### 1. ๐ ูุธุงู ุงููุตุงุฏูุฉ (Authentication System)
**ุงููููุงุช:**
- `lib/authService.ts` - Service layer ููู API
- `contexts/AuthContext.tsx` - ุฅุฏุงุฑุฉ ุญุงูุฉ ุงููุณุชุฎุฏู
- `app/login/page.tsx` - ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- `app/register/page.tsx` - ุตูุญุฉ ุงูุชุณุฌูู
- `app/change-password/page.tsx` - ุตูุญุฉ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

**ุงููุธุงุฆู:**
- โ ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ
- โ ุชุณุฌูู ุฏุฎูู
- โ ุฏุฎูู ูุถูู
- โ ุชุณุฌูู ุฎุฑูุฌ
- โ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
- โ Auto-refresh ููู Access Token (ูู 10 ุฏูุงุฆู)
- โ Protected routes

**API Endpoints:**
```
POST /api/auth/register
POST /api/auth/login
POST /api/auth/guest-login
POST /api/auth/refresh-token
POST /api/auth/logout
POST /api/auth/change-password
```

**ุงูุชูุซูู:**
- `AUTH_INTEGRATION.md` - ุฏููู ุงูุชูุงูู ุงููุงูู
- `REDIRECT_FIX.md` - ุฅุตูุงุญ ูุดููุฉ ุงูุชุญููู ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
- `CHANGE_PASSWORD_FEATURE.md` - ุชูุซูู ููุฒุฉ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

---

### 2. ๐ ูุธุงู ุบุฑู ุงูุฏุฑุฏุดุฉ (Chat Rooms System)
**ุงููููุงุช:**
- `lib/chatRoomsService.ts` - Service layer ููู API
- `app/page.tsx` - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (ุชุญุฏูุซ ูุงูู)

**ุงููุธุงุฆู:**
- โ ุนุฑุถ ูุงุฆูุฉ ุงูุบุฑู ูู API (ุฏููุงููููุฉ)
- โ ุชุฑุชูุจ ุงูุบุฑู ุญุณุจ ุงููุดุงุท
- โ ุฅูุดุงุก ุบุฑูุฉ ุฌุฏูุฏุฉ (ูุน modal ููุจุซู)
- โ ุงูุงูุถูุงู ููุบุฑูุฉ ูุงูุญุตูู ุนูู Agora Token
- โ ูุบุงุฏุฑุฉ ุงูุบุฑูุฉ
- โ ุนุฑุถ ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุดุทูู
- โ ุฏุนู ุงูุบุฑู ุงูุฎุงุตุฉ (ุฃููููุฉ ๐)

**API Endpoints:**
```
GET  /api/chatrooms              - ุฌูุจ ุงูุบุฑู ุงูุนุงูุฉ
GET  /api/chatrooms?userId=X     - ุฌูุจ ุบุฑู ุงููุณุชุฎุฏู
POST /api/chatrooms              - ุฅูุดุงุก ุบุฑูุฉ
POST /api/chatrooms/{id}/join    - ุงูุงูุถูุงู ููุบุฑูุฉ + Agora Token
POST /api/chatrooms/{id}/leave   - ูุบุงุฏุฑุฉ ุงูุบุฑูุฉ
DELETE /api/chatrooms/{id}/members/{userId}  - ุฅุฒุงูุฉ ุนุถู
POST /api/chatrooms/{id}/ban     - ุญุธุฑ ูุณุชุฎุฏู
DELETE /api/chatrooms/{id}/ban/{userId}  - ุฅูุบุงุก ุญุธุฑ
POST /api/chatrooms/{id}/mute    - ูุชู ูุณุชุฎุฏู
DELETE /api/chatrooms/{id}/mute/{userId}  - ุฅูุบุงุก ูุชู
```

**ุงูุชูุซูู:**
- `CHATROOMS_API_INTEGRATION.md` - ุฏููู ุชูุงูู Chat Rooms API
- `CREATE_ROOM_FEATURE.md` - ุชูุซูู ููุฒุฉ ุฅูุดุงุก ุงูุบุฑู

---

### 3. ๐ค ูุธุงู ุงูููุงููุงุช ุงูุตูุชูุฉ (Voice Chat)
**ุงููููุงุช:**
- `hooks/useAgoraVoice.ts` - Hook ููุชุญูู ูู Agora
- `hooks/usePusherChat.ts` - Hook ููุฏุฑุฏุดุฉ ุงููุตูุฉ
- `components/VoiceChatRoom.tsx` - ูููู ุงูุบุฑูุฉ ุงูุตูุชูุฉ
- ููููุงุช ูุฑุนูุฉ ูู `components/chat/`:
  - `HeaderBar.tsx` - ุดุฑูุท ุงูุนููุงู
  - `VoiceControls.tsx` - ุฃุฒุฑุงุฑ ุงูุชุญูู ุงูุตูุชู
  - `ChatSection.tsx` - ูุณู ุงูุฏุฑุฏุดุฉ ุงููุตูุฉ
  - `ParticipantsSidebar.tsx` - ูุงุฆูุฉ ุงููุดุงุฑููู

**ุงููุธุงุฆู:**
- โ ุงูุงูุถูุงู ูููุงุฉ ุตูุชูุฉ ุนุจุฑ Agora
- โ ูุชู/ุฅูุบุงุก ูุชู ุงููููุฑูููู
- โ ุนุฑุถ ุงููุดุงุฑููู ูู ุงูููุช ุงููุนูู
- โ ุฏุฑุฏุดุฉ ูุตูุฉ ุนุจุฑ Pusher
- โ ูุบุงุฏุฑุฉ ุงูุบุฑูุฉ

**ุงูุชูุงูู ูุน API:**
- ูุชู ุชุณุฌูู ุงูุนุถููุฉ ูู ุงูุบุฑูุฉ ุนุจุฑ Chat Rooms API
- Agora Token ููููุฏ ุฏููุงููููุงู ูู Netlify Function
- Token ุตุงูุญ ููุฏุฉ ุณุงุนุฉ ูุงุญุฏุฉ
- ูุชู ุชุฎุฒููู ูู localStorage

---

### 4. ๐จ ุงูุชุตููู ูุงููุงุฌูุฉ (UI/UX)
**ุงููููุฒุงุช:**
- โ ุชุตููู ูุชุฌุงูุจ (Responsive)
- โ Dark theme ูุน ุชุฏุฑุฌุงุช ููููุฉ
- โ Animations ูุชุฃุซูุฑุงุช ุฌูููุฉ
- โ Loading states ูุงุถุญุฉ
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
- โ PWA support (ูููู ุชุซุจูุชู)

**ุงูููููุงุช:**
- `InstallPWAButton.tsx` - ุฒุฑ ุชุซุจูุช ุงูุชุทุจูู

---

## ๐ ูููู ุงููุดุฑูุน

```
voice-chat-pwa/
โโโ app/
โ   โโโ page.tsx                    # ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (ูุงุฆูุฉ ุงูุบุฑู)
โ   โโโ login/page.tsx              # ุชุณุฌูู ุงูุฏุฎูู
โ   โโโ register/page.tsx           # ุงูุชุณุฌูู
โ   โโโ change-password/page.tsx    # ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
โ   โโโ layout.tsx                  # Layout ูุน AuthProvider
โ
โโโ components/
โ   โโโ VoiceChatRoom.tsx           # ุงูุบุฑูุฉ ุงูุตูุชูุฉ ุงูุฑุฆูุณูุฉ
โ   โโโ InstallPWAButton.tsx        # ุฒุฑ ุชุซุจูุช PWA
โ   โโโ chat/                       # ููููุงุช ุงูุฏุฑุฏุดุฉ
โ       โโโ HeaderBar.tsx
โ       โโโ VoiceControls.tsx
โ       โโโ ChatSection.tsx
โ       โโโ ParticipantsSidebar.tsx
โ
โโโ contexts/
โ   โโโ AuthContext.tsx             # Context ูููุตุงุฏูุฉ
โ
โโโ hooks/
โ   โโโ useAgoraVoice.ts            # Hook ููุตูุช
โ   โโโ usePusherChat.ts            # Hook ููุฏุฑุฏุดุฉ
โ
โโโ lib/
โ   โโโ authService.ts              # ุฎุฏูุงุช ุงููุตุงุฏูุฉ
โ   โโโ chatRoomsService.ts         # ุฎุฏูุงุช ุงูุบุฑู
โ
โโโ public/
โ   โโโ manifest.json               # PWA manifest
โ   โโโ service-worker.js           # Service Worker
โ
โโโ ูููุงุช ุงูุชูุซูู:
    โโโ AUTH_INTEGRATION.md
    โโโ REDIRECT_FIX.md
    โโโ CHANGE_PASSWORD_FEATURE.md
    โโโ CHATROOMS_API_INTEGRATION.md
    โโโ CREATE_ROOM_FEATURE.md
    โโโ PROJECT_SUMMARY.md (ูุฐุง ุงูููู)
```

---

## ๐ ุงูุชุฏูู ุงููุงูู (Complete Flow)

### 1. ุชุณุฌูู ุงูุฏุฎูู:
```
ุงููุณุชุฎุฏู ููุชุญ ุงูุชุทุจูู
  โ
ูุชู ุงูุชุญูู ูู localStorage (accessToken)
  โ
ุฅุฐุง ูู ููู ููุฌูุฏ โ ุฅุนุงุฏุฉ ุชูุฌูู ูู /login
  โ
ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู (ุฃู ูุถูู)
  โ
ุญูุธ tokens ูู localStorage
  โ
ุชุญุฏูุซ AuthContext
  โ
ุฅุนุงุฏุฉ ุชูุฌูู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
```

### 2. ุนุฑุถ ุงูุบุฑู:
```
ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ุชูุญูู
  โ
ุงุณุชุฏุนุงุก GET /api/chatrooms
  โ
ุนุฑุถ ุงูุบุฑู ูุฑุชุจุฉ ุญุณุจ ุงููุดุงุท
  โ
ุนุฑุถ ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุดุทูู ูู ูู ุบุฑูุฉ
```

### 3. ุงูุงูุถูุงู ูุบุฑูุฉ:
```
ุงููุณุชุฎุฏู ูุถุบุท ุนูู ุบุฑูุฉ
  โ
ุงุณุชุฏุนุงุก POST /api/chatrooms/{id}/join (ุชุณุฌูู ุงูุนุถููุฉ)
  โ
ุงูุญุตูู ุนูู Agora Token ูู Netlify Function
GET /.netlify/functions/agora-token
  โ
ุญูุธ Token ูู localStorage
  โ
ูุชุญ VoiceChatRoom
  โ
ุงูุงูุถูุงู ูู Agora voice channel
  โ
ุงูุงุชุตุงู ุจู Pusher ููุฏุฑุฏุดุฉ ุงููุตูุฉ
```

### 4. ุฅูุดุงุก ุบุฑูุฉ:
```
ุงููุณุชุฎุฏู ูุถุบุท "ุฅูุดุงุก ุบุฑูุฉ ุฌุฏูุฏุฉ"
  โ
ููุชุญ Modal
  โ
ูููุฃ ุงูุจูุงูุงุช (ุงุณูุ ูุตูุ ุฎุตูุตูุฉ)
  โ
ุงุณุชุฏุนุงุก POST /api/chatrooms
  โ
ุฅุนุงุฏุฉ ุชุญููู ูุงุฆูุฉ ุงูุบุฑู
  โ
ุงูุงูุถูุงู ุงูุชููุงุฆู ููุบุฑูุฉ ุงูุฌุฏูุฏุฉ
```

---

## ๐ ุงูุฃูุงู (Security)

### ุชู ุชูููุฐู:
- โ JWT Authentication (Access + Refresh Tokens)
- โ Access Token: 15 ุฏูููุฉ
- โ Refresh Token: 7 ุฃูุงู
- โ Auto-refresh ูู 10 ุฏูุงุฆู
- โ Protected routes (AuthContext)
- โ ุฅุฑุณุงู Authorization header ูุน ูู ุทูุจ
- โ ุชุดููุฑ ูููุงุช ุงููุฑูุฑ (ูู Backend)
- โ Password validation (8+ ุฃุญุฑูุ ุญุฑู ูุจูุฑุ ุตุบูุฑุ ุฑูู)

### ุชูุตูุงุช ูููุณุชูุจู:
- โ๏ธ ุงุณุชุฎุฏุงู httpOnly cookies ุจุฏูุงู ูู localStorage
- โ๏ธ CSRF protection
- โ๏ธ Rate limiting
- โ๏ธ Input sanitization (XSS protection)
- โ๏ธ SQL Injection protection (ูู Backend)

---

## ๐ฏ ุงูููุฒุงุช ุงููุชุจููุฉ (Optional)

### ูุธุงุฆู ุงูุฅุฏุงุฑุฉ:
- โ ุฅุฒุงูุฉ ุนุถู ูู ุบุฑูุฉ (UI)
- โ ุญุธุฑ ูุณุชุฎุฏู (UI)
- โ ูุชู ูุณุชุฎุฏู (UI)
- โ ุฅูุบุงุก ุญุธุฑ/ูุชู (UI)
- โ ููุญุฉ ุชุญูู ูููุดุฑููู

**ููุงุญุธุฉ:** ุงูู Service Layer ุฌุงูุฒ ูู `chatRoomsService.ts`ุ ูุญุชุงุฌ ููุท UI.

### ุชุญุณููุงุช ุฅุถุงููุฉ:
- โ SignalR ููุฅุดุนุงุฑุงุช ุงูููุฑูุฉ
- โ Auto-refresh ููุบุฑู (ูู 30 ุซุงููุฉ)
- โ ุงูุจุญุซ ุนู ุบุฑู
- โ ุงูุชุตููุฉ (ุนุงูุฉ/ุฎุงุตุฉ/ูุดุทุฉ)
- โ ุฅุญุตุงุฆูุงุช ุงูุบุฑูุฉ
- โ ุชุนุฏูู ุจูุงูุงุช ุงูุบุฑูุฉ
- โ ุญุฐู ุบุฑูุฉ
- โ ุฏุนูุฉ ุฃุนุถุงุก ููุบุฑู ุงูุฎุงุตุฉ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุนุฏุฏ ุงููููุงุช:
- **Frontend Files:** ~20 ููู
- **Documentation Files:** 6 ูููุงุช ุชูุซูู ุดุงููุฉ
- **Total Lines:** ~3000+ ุณุทุฑ ููุฏ

### ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ:
- Next.js 16.0.1
- React 19
- TypeScript
- Tailwind CSS
- Agora RTC SDK
- Pusher
- JWT

---

## ๐ ููููุฉ ุงูุชุดุบูู

### 1. ุชุซุจูุช Dependencies:
```bash
npm install
```

### 2. ุฅุนุฏุงุฏ Environment Variables:
ุฅูุดุงุก ููู `.env.local`:
```env
# API Base URL
NEXT_PUBLIC_API_URL=https://your-api.com/api/auth

# Agora (Voice/Video)
NEXT_PUBLIC_AGORA_APP_ID=your_agora_app_id
NEXT_PUBLIC_AGORA_TOKEN=your_static_token_or_leave_empty
AGORA_PRIMARY_CERTIFICATE=your_agora_primary_certificate

# Pusher (Text Chat)
NEXT_PUBLIC_PUSHER_KEY=your_pusher_key
NEXT_PUBLIC_PUSHER_CLUSTER=eu
```

### 3. ุชุดุบูู ุงูุชุทุจูู:
```bash
npm run dev
```

ุงูุขู ุงูุชุญ: http://localhost:3000

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ ุงูุฃุณุงุณูุฉ:

#### 1. ุงููุตุงุฏูุฉ:
- โ ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ
- โ ุชุณุฌูู ุฏุฎูู
- โ ุฏุฎูู ูุถูู
- โ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ (ูููุณุชุฎุฏููู ุงููุณุฌููู ููุท)
- โ ุชุณุฌูู ุฎุฑูุฌ

#### 2. ุงูุบุฑู:
- โ ุนุฑุถ ูุงุฆูุฉ ุงูุบุฑู
- โ ุฅูุดุงุก ุบุฑูุฉ ุนุงูุฉ
- โ ุฅูุดุงุก ุบุฑูุฉ ุฎุงุตุฉ
- โ ุงูุงูุถูุงู ูุบุฑูุฉ
- โ ูุบุงุฏุฑุฉ ุบุฑูุฉ

#### 3. ุงูููุงููุงุช ุงูุตูุชูุฉ:
- โ ุงูุงูุถูุงู ููููุงุฉ ุงูุตูุชูุฉ
- โ ูุชู ุงููููุฑูููู
- โ ุฅูุบุงุก ูุชู ุงููููุฑูููู
- โ ุณูุงุน ุงููุดุงุฑููู ุงูุขุฎุฑูู
- โ ุนุฑุถ ูุงุฆูุฉ ุงููุดุงุฑููู

#### 4. ุงูุฏุฑุฏุดุฉ ุงููุตูุฉ:
- โ ุฅุฑุณุงู ุฑุณุงูุฉ
- โ ุงุณุชูุจุงู ุฑุณุงุฆู
- โ ุนุฑุถ ุงุณู ุงููุฑุณู
- โ Timestamp ููุฑุณุงุฆู

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. Agora Tokens:
- ุงูู Token ููููุฏ ุฏููุงููููุงู ูู Netlify Function
- ุตุงูุญ ููุฏุฉ ุณุงุนุฉ ูุงุญุฏุฉ (3600 ุซุงููุฉ)
- ููุฎุฒู ูู localStorage
- ููุญุฐู ุนูุฏ ุงููุบุงุฏุฑุฉ
- ูุชุทูุจ `AGORA_PRIMARY_CERTIFICATE` ูู environment variables

### 2. Chat Rooms API:
- **ุจุฏูู `userId`** - ูุฑุฌุน ุงูุบุฑู ุงูุนุงูุฉ ููุท
- **ูุน `userId`** - ูุฑุฌุน ุบุฑู ุงููุณุชุฎุฏู (ุนุงูุฉ + ุฎุงุตุฉ)

### 3. Guest Users:
- ูููููู ุฏุฎูู ุงูุบุฑู
- **ูุง ูููููู:**
  - ุฅูุดุงุก ุบุฑู
  - ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
  - ุงููุตูู ูุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅูุฌุงุฒ ุชุทุจูู ูุงูู ููุฏุฑุฏุดุฉ ุงูุตูุชูุฉ ูุน:

โ **ูุธุงู ูุตุงุฏูุฉ ูุงูู** ูุน JWT
โ **ุชูุงูู ูุงูู** ูุน Chat Rooms API
โ **ููุงููุงุช ุตูุชูุฉ** ุนุจุฑ Agora
โ **ุฏุฑุฏุดุฉ ูุตูุฉ** ุนุจุฑ Pusher
โ **ุฅูุดุงุก ุบุฑู** ูุน ุฎูุงุฑุงุช ูุชูุฏูุฉ
โ **ุชุตููู ุฌููู** ููุชุฌุงูุจ
โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก** ุดุงููุฉ
โ **ุชูุซูู ูุงูู** ููู ููุฒุฉ

ุงูุชุทุจูู **ุฌุงูุฒ ููุงุณุชุฎุฏุงู** ููุนูู ุจููุงุกุฉ! ๐

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-11-01
**ุงูุฅุตุฏุงุฑ:** 1.0.0
**ุงููุทูุฑ:** Claude Code Assistant
